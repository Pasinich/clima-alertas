/* =========================
   GEOLOCALIZAÃ‡ÃƒO INICIAL
========================= */
if (navigator.geolocation) {

  nomeCidade.innerText = "ğŸ“Buscando sua localizaÃ§Ã£o...";

  navigator.geolocation.getCurrentPosition(
    async (pos) => {

      lat = pos.coords.latitude;
      lon = pos.coords.longitude;

      try {
        const r = await fetch(
          `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=pt`
        );
        const d = await r.json();

        if (d?.results?.length) {
          const c = d.results[0];

          let local;

          if (c.country_code === "BR" && c.admin1) {
            local = `${c.name} - ${c.admin1}`;
          } else if (c.admin1) {
            local = `${c.name} - ${c.admin1} - ${c.country}`;
          } else {
            local = `${c.name} - ${c.country}`;
          }

          nomeCidade.innerText = local;

          paisSelecionado = c.country_code;
          estadoSelecionado = c.admin1 ?? null;

        } else {
          nomeCidade.innerText = "ğŸ“LocalizaÃ§Ã£o atual";
        }

      } catch (erro) {
        nomeCidade.innerText = "ğŸ“LocalizaÃ§Ã£o atual";
      }

      limparTela();
      buscar();
    },
    () => {
      nomeCidade.innerText = "ğŸ“PermissÃ£o negada";
    }
  );

}
