/* ===== GEOLOCALIZAÇÃO INICIAL ===== */
navigator.geolocation?.getCurrentPosition(async p => {
  const lat = p.coords.latitude;
  const lon = p.coords.longitude;

  try {
    // Geocodificação reversa para pegar cidade e estado
    const res = await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=pt`);
    const data = await res.json();
    
    // Pega a cidade e a região/estado
    const cidade = data?.results?.[0]?.name ?? "";
    const estado = data?.results?.[0]?.admin1 ?? "";
    
    // Se existir, mostra cidade + estado, senão só "Sua Localização"
    nomeCidade.innerText = cidade ? `${cidade}${estado ? ", " + estado : ""}` : "Sua Localização";

  } catch (e) {
    console.error("Erro ao obter cidade:", e);
    nomeCidade.innerText = "Sua Localização";
  }

  // Chama função de buscar clima usando lat/lon
  buscar();
});